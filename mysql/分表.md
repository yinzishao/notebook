你分库分表就俩原因，要不就是单库并发太高，要不就是单库数据量太大；除非是你并发不高，但是数据量太大导致的分库分表扩容，你可以用这个方案，因为可能每秒最高并发最多就几百，那么就走单独的一个库和表生成自增主键即可。


## 垂直拆分

简单来说垂直拆分是指**数据表列的拆分**，把**一张列比较多的表拆分为多张表**

垂直拆分的优点：
- 可以使得**行数据变小**，在查询时**减少读取的Block数，减少I/O次数**。
- 此外，垂直分区可以**简化表的结构，易于维护**。

> 行数据变小，减少读取的Block数，减少I/O次数。简化表的结构，易于维护

垂直拆分的缺点：
- **主键会出现冗余，需要管理冗余列，并会引起Join操作**，可以通过在应用层进行Join来解决。
- 此外，垂直分区会**让事务变得更加复杂**；

> 冗余字段，事务复杂化。加大复杂的逻辑处理

## 水平分区

**保持数据表结构不变，通过某种策略存储数据分片**。这样每一片数据分散到不同的表或者库中，达到了分布式的目的。水平拆分可以支撑非常大的数据量。

水品拆分可以支持非常大的数据量。需要注意的一点是:**分表仅仅是解决了单一表数据过大的问题**，但由于表的数据还是在同一台机器上，其实对于提升MySQL并发能力没有什么意义，所以 **水平拆分最好分库** 。

水平拆分能够 支持非常大的数据量存储，应用端改造也少，但**分片事务难以解决 ，跨界点Join性能较差，逻辑复杂**。

> 分片事务难以解决 ，跨界点Join性能较差，逻辑复杂。中间件网络I/O

《Java工程师修炼之道》的作者推荐 尽量不要对数据进行分片，因为拆分会带来逻辑、部署、运维的各种复杂度 ，一般的数据表在优化得当的情况下支撑**千万以下的数据量是没有太大问题的**。如果实在要分片，尽量**选择客户端分片架构，这样可以减少一次和中间件的网络I/O**。

#### 分库分表后面临的问题

- 事务支持分库分表后，就成了**分布式事务**了。如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价；如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。

- **跨库join**。只要是进行切分，跨节点Join的问题是不可避免的。但是良好的设计和切分却可以减少此类情况的发生。解决这一问题的普遍做法是**分两次查询实现**。在第一次查询的结果集中找出关联数据的id,根据这些id发起第二次请求得到关联数据。分库分表方案产品

- **跨节点的**count,order by,group by以及**聚合函数问题** 这些是一类问题。因为它们都需要基于全部数据集合进行计算。多数的代理都不会自动处理合并工作。解决方案：与解决跨节点join问题的类似，**分别在各个节点上得到结果后在应用程序端进行合并**。和join不同的是每个结点的查询可以**并行执行**，因此很多时候它的速度要比单一大表快很多。但如果结果集很大，对**应用程序内存的消耗**是一个问题。

- **数据迁移，容量规划，扩容等问题**。来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，**避免了行级别的数据迁移**，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了**Sharding扩容的难度**。

- **ID问题**。一旦数据库被切分到多个物理结点上，我们将**不能再依赖数据库自身的主键生成机制**。一方面，某个分区数据库自生成的ID**无法保证在全局上是唯一的**；另一方面，应用程序在插入数据之前需要先获得ID,以便进行SQL路由. 一些常见的主键生成策略。

> 雪花算法
